{"version":3,"sources":["database.ts","scores.ts","server.ts"],"names":["dbFilePath","db","Database","create","list","makeScore","obj","created_at","value","player","prepare","run","insertScore","req","res","body","status","send","message","score","_a","listScores","_","all","bodyParser","scores","VERSION","console","log","app","use","json","post","get","listener","listen","address","port"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QCWgBG,SAAAA;QAqBAC,OAAAA;;AAhChB;;;;;;AACA,IAAIC,YAAY,SAAZA,SAAY,CAAUC,GAAV,EAAe;AAC3B,QAAI,OAAOA,IAAIC,UAAX,KAA0B,QAA1B,IACA,OAAOD,IAAIE,KAAX,KAAqB,QADrB,IAEA,OAAOF,IAAIG,MAAX,KAAsB,QAF1B,EAEoC;AAChC,eAAOH,GAAP;AACH;AACD,WAAO,IAAP;AACH,CAPD;AAQAL,mBAAGS,OAAH,CAAW,8KAAX,EAA2LC,GAA3L;AACA,IAAIC,cAAcX,mBAAGS,OAAH,CAAW,iGAAX,CAAlB;AACO,SAASP,MAAT,CAAgBU,GAAhB,EAAqBC,GAArB,EAA0B;AAC7B,QAAI,CAACD,IAAIE,IAAT,EAAe;AACX,eAAOD,IAAIE,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACxBC,qBAAS;AADe,SAArB,CAAP;AAGH;AACD,QAAIC,QAAQd,UAAUQ,IAAIE,IAAd,CAAZ;AACA,QAAI,CAACI,KAAL,EAAY;AACR,eAAOL,IAAIE,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACxBC,qBAAS;AADe,SAArB,CAAP;AAGH;AACD,QAAI;AACAN,oBAAYD,GAAZ,CAAgBQ,KAAhB;AACH,KAFD,CAGA,OAAOC,EAAP,EAAW;AACP,eAAON,IAAIE,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,EAAP;AACH;AACD,WAAOH,IAAIE,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,EAAP;AACH;AACD,IAAII,aAAapB,mBAAGS,OAAH,CAAW,4BAAX,CAAjB;AACO,SAASN,IAAT,CAAckB,CAAd,EAAiBR,GAAjB,EAAsB;AACzB,QAAI;AACA,eAAOA,IAAIE,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBI,WAAWE,GAAX,EAArB,CAAP;AACH,KAFD,CAGA,OAAOH,EAAP,EAAW;AACP,eAAON,IAAIE,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,EAAP;AACH;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ADvCD;;;;;;AACA,IAAIjB,aAAa,mBAAjB;AACA,IAAIC,KAAK,IAAIC,sBAAJ,CAAaF,UAAb,CAAT;kBACeC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEHf;;IAAYuB;;AACZ;;;;AACA;;IAAYC;;;;;;AACZ,IAAIC,UAAU,IAAd;AACAC,QAAQC,GAAR,CAAY,UAAZ;AACA,IAAIC,MAAM,wBAAV;AACAA,IAAIC,GAAJ,CAAQN,WAAWO,IAAX,EAAR;AACAF,IAAIG,IAAJ,CAAS,MAAMN,OAAN,GAAgB,SAAzB,EAAoCD,OAAOtB,MAA3C;AACA0B,IAAII,GAAJ,CAAQ,MAAMP,OAAN,GAAgB,SAAxB,EAAmCD,OAAOrB,IAA1C;AACA,IAAI8B,WAAWL,IAAIM,MAAJ,SAA6B,YAAY;AACpDR,YAAQC,GAAR,CAAY,8BAA8BM,SAASE,OAAT,GAAmBC,IAA7D;AACH,CAFc,CAAf","file":"server.map","sourceRoot":"../src","sourcesContent":["import Database from 'better-sqlite3';\nvar dbFilePath = './.data/sqlite.db';\nvar db = new Database(dbFilePath);\nexport default db;\n","import db from './database';\nvar makeScore = function (obj) {\n    if (typeof obj.created_at === 'number' &&\n        typeof obj.value === 'number' &&\n        typeof obj.player === 'string') {\n        return obj;\n    }\n    return null;\n};\ndb.prepare(\"\\n  CREATE TABLE IF NOT EXISTS scores (\\n    player      varchar,\\n    value       integer,\\n    created_at  timestamp NOT NULL,\\n    PRIMARY KEY (player, created_at)\\n  );\").run();\nvar insertScore = db.prepare(\"\\n  INSERT INTO scores (player, value, created_at)\\n    VALUES (@player, @value, @created_at)\\n\");\nexport function create(req, res) {\n    if (!req.body) {\n        return res.status(400).send({\n            message: \"Body can't be empty.\",\n        });\n    }\n    var score = makeScore(req.body);\n    if (!score) {\n        return res.status(400).send({\n            message: 'Body is not a Score.',\n        });\n    }\n    try {\n        insertScore.run(score);\n    }\n    catch (_a) {\n        return res.status(500).send();\n    }\n    return res.status(200).send();\n}\nvar listScores = db.prepare(\"\\n  SELECT * FROM scores\\n\");\nexport function list(_, res) {\n    try {\n        return res.status(200).send(listScores.all());\n    }\n    catch (_a) {\n        return res.status(500).send();\n    }\n}\n","import * as bodyParser from 'body-parser';\nimport express from 'express';\nimport * as scores from './scores';\nvar VERSION = 'v1';\nconsole.log('Running.');\nvar app = express();\napp.use(bodyParser.json());\napp.post(\"/\" + VERSION + \"/scores\", scores.create);\napp.get(\"/\" + VERSION + \"/scores\", scores.list);\nvar listener = app.listen(process.env.PORT, function () {\n    console.log(\"Your app is listening on \" + listener.address().port);\n});\n"]}